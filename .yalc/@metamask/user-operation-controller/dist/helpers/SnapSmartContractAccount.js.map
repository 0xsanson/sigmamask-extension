{"version":3,"file":"SnapSmartContractAccount.js","sourceRoot":"","sources":["../../src/helpers/SnapSmartContractAccount.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,4CAAqE;AAYrE,MAAa,wBAAwB;IAGnC,YAAY,SAA2C;QAFvD,sDAA6C;QAG3C,uBAAA,IAAI,uCAAc,SAAS,MAAA,CAAC;IAC9B,CAAC;IAEK,oBAAoB,CACxB,OAAoC;;YAEpC,MAAM,EACJ,IAAI,EAAE,WAAW,EACjB,IAAI,EAAE,MAAM,EACZ,EAAE,EAAE,SAAS,EACb,KAAK,EAAE,YAAY,GACpB,GAAG,OAAO,CAAC;YAEZ,MAAM,IAAI,GAAG,WAAW,aAAX,WAAW,cAAX,WAAW,GAAI,uBAAW,CAAC;YACxC,MAAM,EAAE,GAAG,SAAS,aAAT,SAAS,cAAT,SAAS,GAAI,wBAAY,CAAC;YACrC,MAAM,KAAK,GAAG,YAAY,aAAZ,YAAY,cAAZ,YAAY,GAAI,sBAAU,CAAC;YAEzC,MAAM,QAAQ,GAAG,MAAM,uBAAA,IAAI,2CAAW,CAAC,IAAI,CACzC,wCAAwC,EACxC,MAAM,EACN,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,CACtB,CAAC;YAEF,MAAM,EACJ,UAAU,EAAE,OAAO,EACnB,QAAQ,EACR,qBAAqB,EACrB,cAAc,EACd,SAAS,EAAE,GAAG,EACd,QAAQ,EACR,KAAK,GACN,GAAG,QAAQ,CAAC;YAEb,OAAO;gBACL,OAAO;gBACP,QAAQ;gBACR,qBAAqB;gBACrB,cAAc;gBACd,GAAG;gBACH,QAAQ;gBACR,KAAK;gBACL,MAAM;aACP,CAAC;QACJ,CAAC;KAAA;IAEK,mBAAmB,CACvB,OAAmC;;YAEnC,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,MAAM,EAAE,MAAM,EAAE,GAAG,aAAa,CAAC;YAEjC,MAAM,EAAE,gBAAgB,EAAE,wBAAwB,EAAE,GAClD,MAAM,uBAAA,IAAI,2CAAW,CAAC,IAAI,CACxB,sCAAsC,EACtC,MAAM,EACN,aAAa,CACd,CAAC;YAEJ,MAAM,gBAAgB,GACpB,wBAAwB,KAAK,uBAAW;gBACtC,CAAC,CAAC,SAAS;gBACX,CAAC,CAAC,wBAAwB,CAAC;YAE/B,OAAO;gBACL,gBAAgB;aACjB,CAAC;QACJ,CAAC;KAAA;IAEK,iBAAiB,CACrB,OAAiC;;YAEjC,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,MAAM,EAAE,MAAM,EAAE,GAAG,aAAa,CAAC;YAEjC,MAAM,SAAS,GAAG,MAAM,uBAAA,IAAI,2CAAW,CAAC,IAAI,CAC1C,qCAAqC,EACrC,MAAM,EACN,aAAa,CACd,CAAC;YAEF,OAAO,EAAE,SAAS,EAAE,CAAC;QACvB,CAAC;KAAA;CACF;AAtFD,4DAsFC","sourcesContent":["import { ADDRESS_ZERO, EMPTY_BYTES, VALUE_ZERO } from '../constants';\nimport type {\n  PrepareUserOperationRequest,\n  PrepareUserOperationResponse,\n  SignUserOperationRequest,\n  SignUserOperationResponse,\n  SmartContractAccount,\n  UpdateUserOperationRequest,\n  UpdateUserOperationResponse,\n} from '../types';\nimport type { UserOperationControllerMessenger } from '../UserOperationController';\n\nexport class SnapSmartContractAccount implements SmartContractAccount {\n  #messenger: UserOperationControllerMessenger;\n\n  constructor(messenger: UserOperationControllerMessenger) {\n    this.#messenger = messenger;\n  }\n\n  async prepareUserOperation(\n    request: PrepareUserOperationRequest,\n  ): Promise<PrepareUserOperationResponse> {\n    const {\n      data: requestData,\n      from: sender,\n      to: requestTo,\n      value: requestValue,\n    } = request;\n\n    const data = requestData ?? EMPTY_BYTES;\n    const to = requestTo ?? ADDRESS_ZERO;\n    const value = requestValue ?? VALUE_ZERO;\n\n    const response = await this.#messenger.call(\n      'KeyringController:prepareUserOperation',\n      sender,\n      [{ data, to, value }],\n    );\n\n    const {\n      bundlerUrl: bundler,\n      callData,\n      dummyPaymasterAndData,\n      dummySignature,\n      gasLimits: gas,\n      initCode,\n      nonce,\n    } = response;\n\n    return {\n      bundler,\n      callData,\n      dummyPaymasterAndData,\n      dummySignature,\n      gas,\n      initCode,\n      nonce,\n      sender,\n    };\n  }\n\n  async updateUserOperation(\n    request: UpdateUserOperationRequest,\n  ): Promise<UpdateUserOperationResponse> {\n    const { userOperation } = request;\n    const { sender } = userOperation;\n\n    const { paymasterAndData: responsePaymasterAndData } =\n      await this.#messenger.call(\n        'KeyringController:patchUserOperation',\n        sender,\n        userOperation,\n      );\n\n    const paymasterAndData =\n      responsePaymasterAndData === EMPTY_BYTES\n        ? undefined\n        : responsePaymasterAndData;\n\n    return {\n      paymasterAndData,\n    };\n  }\n\n  async signUserOperation(\n    request: SignUserOperationRequest,\n  ): Promise<SignUserOperationResponse> {\n    const { userOperation } = request;\n    const { sender } = userOperation;\n\n    const signature = await this.#messenger.call(\n      'KeyringController:signUserOperation',\n      sender,\n      userOperation,\n    );\n\n    return { signature };\n  }\n}\n"]}